(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{7486:function(e,t,a){Promise.resolve().then(a.bind(a,4205))},1525:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}}),a(2265);var s=a(7437);function r(e){let{children:t,variant:a="primary",size:r="md",fullWidth:n=!1,loading:l=!1,icon:o,className:c="",disabled:i,...d}=e;return(0,s.jsxs)("button",{className:"btn ".concat({primary:"btn-primary",secondary:"btn-secondary",danger:"btn-danger",ghost:"btn-ghost",neon:"btn-neon"}[a]," ").concat({sm:"btn-sm",md:"btn-md",lg:"btn-lg"}[r]," ").concat(n?"btn-full":""," ").concat(l?"btn-loading":""," ").concat(c),disabled:i||l,...d,children:[l&&(0,s.jsx)("span",{className:"btn-spinner"}),o&&!l&&(0,s.jsx)("span",{className:"btn-icon",children:o}),(0,s.jsx)("span",{children:t})]})}},2711:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}}),a(2265);var s=a(7437);function r(e){let{children:t,className:a="",variant:r="default",hover:n=!1,padding:l="md"}=e;return(0,s.jsx)("div",{className:"card ".concat({default:"card-default",glass:"card-glass",gradient:"card-gradient",bordered:"card-bordered"}[r]," ").concat({sm:"p-4",md:"p-6",lg:"p-8"}[l]," ").concat(n?"card-hover":""," ").concat(a),children:t})}},3491:function(e,t,a){"use strict";a.d(t,{a:function(){return r}});var s=a(2265);function r(){let[e,t]=(0,s.useState)(null),[a,r]=(0,s.useState)(null),[n,l]=(0,s.useState)(null),[o,c]=(0,s.useState)(!0),i=async()=>{let e=localStorage.getItem("authToken");if(!e){c(!1);return}try{let t=await fetch("http://localhost:3001/api/auth/me",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();l(e)}else d()}catch(e){console.error("Erro ao carregar dados do usu\xe1rio:",e)}finally{c(!1)}};(0,s.useEffect)(()=>{let e=localStorage.getItem("authToken");localStorage.getItem("refreshToken");let a=localStorage.getItem("userAddress");e&&a&&(t(e),r(a)),i()},[]);let d=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("userAddress"),t(null),r(null),l(null)};return{token:e,address:a,user:n,isAuthenticated:!!e,loading:o,logout:d,refreshUser:i}}},4205:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var s=a(2265),r=a(2921),n=a(2711),l=a(8028),o=a(1525),c=a(7437);function i(e){let{onSuccess:t,onError:a}=e,[r,i]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),[m,h]=(0,s.useState)(null),[x,f]=(0,s.useState)(null),g=async()=>{try{i(!0),f(null);let e=window.ethereum;if(!e)throw Error("MetaMask n\xe3o encontrado. Instale a extens\xe3o!");let a=new l.Q(e),s=(await a.send("eth_requestAccounts",[]))[0];h(s);let r="\nStreamPay AI Authentication\nAddress: ".concat(s,"\nTimestamp: ").concat(Date.now(),"\n\nAssinando esta mensagem para confirmar sua identidade.\n      ").trim(),n=await a.getSigner();f("\uD83D\uDCDD Assinando mensagem...");let o=await n.signMessage(r);f("\uD83D\uDD04 Verificando assinatura...");let c=await fetch("http://localhost:3001/api/auth/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:s,message:r,signature:o})});if(!c.ok){let e=await c.json();throw Error(e.error||"Falha ao verificar assinatura")}let d=await c.json(),m=d.token,x=d.refreshToken;localStorage.setItem("authToken",m),x&&localStorage.setItem("refreshToken",x),localStorage.setItem("userAddress",s),u(!0),f("✅ Autenticado com sucesso!"),null==t||t(m)}catch(t){let e=t instanceof Error?t.message:String(t);console.error("Erro de autentica\xe7\xe3o:",e),f("❌ ".concat(e)),null==a||a(e),u(!1),h(null)}finally{i(!1)}};return d&&m?(0,c.jsxs)("div",{className:"flex flex-col gap-4 w-full",children:[(0,c.jsxs)(n.Z,{variant:"glass",padding:"md",className:"text-center",children:[(0,c.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Carteira Conectada"}),(0,c.jsxs)("p",{className:"font-mono text-lg",children:[m.slice(0,6),"...",m.slice(-4)]})]}),(0,c.jsx)(o.Z,{onClick:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("userAddress"),u(!1),h(null),f(null)},variant:"ghost",fullWidth:!0,children:"Desconectar"})]}):(0,c.jsxs)("div",{className:"flex flex-col gap-4 w-full",children:[(0,c.jsx)(o.Z,{onClick:g,disabled:r,variant:"neon",size:"lg",fullWidth:!0,children:r?"Conectando...":"Conectar MetaMask"}),x&&(0,c.jsx)(n.Z,{variant:"bordered",padding:"md",className:"text-center",children:(0,c.jsx)("p",{className:"text-sm",children:x})}),(0,c.jsx)("p",{className:"text-xs text-center text-gray-500",children:"ℹ️ Certifique-se de que MetaMask est\xe1 na rede Sepolia testnet"})]})}var d=a(3491);function u(){let e=(0,r.useRouter)(),{isAuthenticated:t,loading:a}=(0,d.a)();return(0,s.useEffect)(()=>{!a&&t&&e.push("/dashboard")},[t,a,e]),(0,c.jsx)("div",{className:"min-h-screen flex items-center justify-center animate-fade-in bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900",children:(0,c.jsxs)(n.Z,{variant:"glass",padding:"lg",className:"w-full max-w-md",children:[(0,c.jsxs)("div",{className:"text-center mb-8",children:[(0,c.jsx)("h1",{className:"text-4xl font-bold mb-2 text-gradient",style:{fontFamily:"var(--font-family-display)"},children:"StreamPay AI"}),(0,c.jsx)("p",{className:"text-secondary",style:{color:"var(--text-secondary)"},children:"Autentica\xe7\xe3o Web3 com MetaMask"})]}),(0,c.jsxs)("div",{className:"mb-6",children:[(0,c.jsx)("p",{className:"text-sm text-center mb-4",style:{color:"var(--text-secondary)"},children:"Conecte sua carteira MetaMask para acessar o StreamPay AI"}),(0,c.jsx)(i,{onSuccess:()=>{setTimeout(()=>{e.push("/dashboard")},1e3)},onError:e=>{console.error("Erro na autentica\xe7\xe3o:",e)}})]}),(0,c.jsxs)("div",{className:"border-t border-gray-300 dark:border-gray-700 pt-6",children:[(0,c.jsx)("h2",{className:"text-sm font-semibold mb-3",style:{color:"var(--text-primary)"},children:"Como funciona:"}),(0,c.jsxs)("ul",{className:"text-xs space-y-2",style:{color:"var(--text-secondary)"},children:[(0,c.jsx)("li",{children:'✅ Clique em "Conectar MetaMask"'}),(0,c.jsx)("li",{children:"✅ Selecione sua carteira"}),(0,c.jsx)("li",{children:"✅ Assine a mensagem para verificar identidade"}),(0,c.jsx)("li",{children:"✅ Receba seu JWT para acessar a plataforma"})]})]}),(0,c.jsx)("div",{className:"mt-6 text-center text-xs",style:{color:"var(--text-secondary)"},children:(0,c.jsxs)("p",{children:["ℹ️ Certifique-se de estar na rede"," ",(0,c.jsx)("strong",{children:"Sepolia Testnet"})]})}),(0,c.jsx)("div",{className:"mt-6 text-center",children:(0,c.jsxs)("p",{className:"text-xs",style:{color:"var(--text-secondary)"},children:["N\xe3o tem MetaMask?"," ",(0,c.jsx)("a",{href:"https://metamask.io/download/",target:"_blank",rel:"noopener noreferrer",className:"hover:underline",style:{color:"var(--color-primary)"},children:"Instale aqui"})]})})]})})}}},function(e){e.O(0,[93,971,529,744],function(){return e(e.s=7486)}),_N_E=e.O()}]);